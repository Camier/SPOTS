<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPOTS - Sun & Shadow Calculator Demo</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
        
        .info-header {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .sun-shadow-controls {
            background: white !important;
        }
        
        /* Custom styles for sun/shadow visualization */
        .sun-position-marker {
            z-index: 1000 !important;
        }
        
        .shadow-polygon {
            pointer-events: none;
        }
        
        /* Legend */
        .sun-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 12px;
        }
        
        .demo-spots {
            position: absolute;
            top: 80px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .demo-spots button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="info-header">
        <h3 style="margin: 0;">‚òÄÔ∏è Calculateur Soleil/Ombre - D√©mo</h3>
        <p style="margin: 5px 0 0 0; font-size: 14px;">
            Visualisez la position du soleil et les ombres pour vos spots
        </p>
    </div>

    <div id="map"></div>
    
    <div class="demo-spots">
        <strong>Spots de d√©mo:</strong>
        <button onclick="goToSpot(43.4617, 1.4442, 'Pic du Canigou')">üèîÔ∏è Pic du Canigou</button>
        <button onclick="goToSpot(42.8736, 0.7389, 'Cascade d\'Ars')">üíß Cascade d'Ars</button>
        <button onclick="goToSpot(43.0581, 1.1389, 'Grotte de Lombrives')">üï≥Ô∏è Grotte de Lombrives</button>
    </div>
    
    <div class="sun-legend">
        <strong>L√©gende:</strong><br>
        ‚òÄÔ∏è Position du soleil<br>
        üåë Zones d'ombre (estimation)<br>
        üìç Spots de d√©monstration
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- SunCalc -->
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    
    <!-- Import our sun/shadow calculator -->
    <script type="module">
        import SunShadowCalculator from './js/modules/sun-shadow-calculator.js';
        
        // Initialize map
        const map = L.map('map', {
            center: [43.2, 1.5], // Center on Ari√®ge
            zoom: 10,
            preferCanvas: true
        });
        
        // Add IGN base layer
        L.tileLayer('https://data.geopf.fr/wmts?' +
            'SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&' +
            'LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&STYLE=normal&' +
            'TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&' +
            'FORMAT=image/png', {
            attribution: '¬© IGN',
            maxZoom: 18
        }).addTo(map);
        
        // Alternative terrain layer
        const terrainLayer = L.tileLayer('https://data.geopf.fr/wmts?' +
            'SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&' +
            'LAYER=ELEVATION.SLOPES&STYLE=normal&' +
            'TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&' +
            'FORMAT=image/png', {
            attribution: '¬© IGN',
            maxZoom: 16,
            opacity: 0.4
        });
        
        // Layer control
        const baseLayers = {
            "Plan IGN": map._layers[Object.keys(map._layers)[0]],
            "Relief": terrainLayer
        };
        
        L.control.layers(baseLayers, {}, { position: 'topleft' }).addTo(map);
        
        // Initialize sun/shadow calculator
        const sunCalc = new SunShadowCalculator(map);
        await sunCalc.init();
        
        // Add demo markers
        const spots = [
            { lat: 43.4617, lng: 1.4442, name: 'Pic du Canigou', type: 'mountain' },
            { lat: 42.8736, lng: 0.7389, name: 'Cascade d\'Ars', type: 'waterfall' },
            { lat: 43.0581, lng: 1.1389, name: 'Grotte de Lombrives', type: 'cave' }
        ];
        
        const icons = {
            mountain: 'üèîÔ∏è',
            waterfall: 'üíß',
            cave: 'üï≥Ô∏è'
        };
        
        spots.forEach(spot => {
            const marker = L.marker([spot.lat, spot.lng], {
                icon: L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="font-size: 24px;">${icons[spot.type]}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                })
            }).addTo(map);
            
            marker.bindPopup(`<strong>${spot.name}</strong><br>
                <small>Lat: ${spot.lat.toFixed(4)}, Lng: ${spot.lng.toFixed(4)}</small>`);
        });
        
        // Global function to navigate to spots
        window.goToSpot = function(lat, lng, name) {
            map.setView([lat, lng], 14);
            setTimeout(() => {
                L.popup()
                    .setLatLng([lat, lng])
                    .setContent(`<strong>${name}</strong>`)
                    .openOn(map);
            }, 500);
        };
        
        // Make map available globally for debugging
        window.demoMap = map;
        window.sunCalc = sunCalc;
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 's') {
                // Toggle sun/shadow
                const isActive = sunCalc.toggle();
                console.log('Sun/shadow calculator:', isActive ? 'ON' : 'OFF');
            }
        });
        
        // Instructions popup
        setTimeout(() => {
            L.popup()
                .setLatLng(map.getCenter())
                .setContent(`
                    <div style="text-align: center;">
                        <strong>üåû Calculateur Soleil/Ombre</strong><br>
                        <small>Utilisez les contr√¥les en haut √† droite<br>
                        ou appuyez sur 'S' pour activer/d√©sactiver</small>
                    </div>
                `)
                .openOn(map);
        }, 1000);
    </script>
</body>
</html>