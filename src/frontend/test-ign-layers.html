<!DOCTYPE html>
<html>
<head>
    <title>IGN Layer Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 400px; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>IGN Layer Test</h1>
    <div id="status" class="status">Testing IGN layers...</div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([43.8, 1.8], 8);
        const statusEl = document.getElementById('status');
        
        // Test layers
        const testLayers = [
            {
                name: 'Plan IGN v2',
                url: 'https://wxs.ign.fr/essentiels/geoportail/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&STYLE=normal&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image/png'
            },
            {
                name: 'SCAN 25',
                url: 'https://wxs.ign.fr/essentiels/geoportail/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN25TOUR&STYLE=normal&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image/jpeg'
            },
            {
                name: 'Satellite',
                url: 'https://wxs.ign.fr/essentiels/geoportail/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&STYLE=normal&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image/jpeg'
            }
        ];
        
        let currentIndex = 0;
        
        function testNextLayer() {
            if (currentIndex >= testLayers.length) {
                statusEl.textContent = 'All tests complete!';
                statusEl.className = 'status success';
                return;
            }
            
            const layerConfig = testLayers[currentIndex];
            statusEl.textContent = `Testing ${layerConfig.name}...`;
            
            // Remove all layers
            map.eachLayer(layer => {
                if (layer instanceof L.TileLayer) {
                    map.removeLayer(layer);
                }
            });
            
            // Add test layer
            const layer = L.tileLayer(layerConfig.url, {
                attribution: '© IGN',
                maxZoom: 18
            });
            
            layer.on('tileload', function() {
                statusEl.textContent = `✓ ${layerConfig.name} loaded successfully!`;
                statusEl.className = 'status success';
                
                // Test next layer after 2 seconds
                setTimeout(() => {
                    currentIndex++;
                    testNextLayer();
                }, 2000);
            });
            
            layer.on('tileerror', function(e) {
                statusEl.textContent = `✗ ${layerConfig.name} failed to load: ${e.error}`;
                statusEl.className = 'status error';
                console.error('Tile error:', e);
                
                // Test next layer after 2 seconds
                setTimeout(() => {
                    currentIndex++;
                    testNextLayer();
                }, 2000);
            });
            
            layer.addTo(map);
        }
        
        // Start testing
        testNextLayer();
    </script>
</body>
</html>